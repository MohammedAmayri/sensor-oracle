/* =======================================================================
   Device Model:   Milesight · Milesight EM500-LGT
   Decoder:        DecoderMilesightEM500LGT
   ThingPark ID:   msight_em500-lgt_RFGroup1_1.0.3a_A
   ======================================================================= */


SET NOCOUNT ON;



DECLARE @deviceModelId int;


DECLARE @iotPlatformDeviceModelId int;


--1. ====================================================================================================================

INSERT INTO dbo.deviceModel
                           (   deviceModelName
                           ,   deviceModelVersion
                           ,   deviceModelSupplier
                           ,   iotPlatformId
                           ,   decoderFunctionName
                           ,   display
                           )

VALUES
(
N'Milesight EM500-LGT',
NULL,
N'Milesight',
1,
N'DecoderMilesightEM500LGT',
1
);



SET @deviceModelId = SCOPE_IDENTITY();


--ProtocolVersion

INSERT INTO dbo.deviceModelAttribute
                           (  deviceModelId
                           ,   dataAttributeId
                           ,   attributeName
                           ,   attributeDescription
                           ,   attributeValueList
                           ,   includeInResponse
                           ,                          notificationType
                           ,                          triggerLogic
                           ,                          triggerValue
                           ,   attributeFriendlyName
                           )

VALUES
(
@deviceModelId,
6,
N'ProtocolVersion',
N'Protokollversion',
N'[ { "value": "number", "description": "Mätvärde", "selectable": false } ]',
'1',
'M',
NULL,
NULL,
N'Protokollversion'
);


--DeviceSN

INSERT INTO dbo.deviceModelAttribute
                           (  deviceModelId
                           ,   dataAttributeId
                           ,   attributeName
                           ,   attributeDescription
                           ,   attributeValueList
                           ,   includeInResponse
                           ,                          notificationType
                           ,                          triggerLogic
                           ,                          triggerValue
                           ,   attributeFriendlyName
                           )

VALUES
(
@deviceModelId,
14,
N'DeviceSN',
N'Serienummer',
N'[ { "value": "string", "description": "Text", "selectable": false } ]',
'1',
'M',
NULL,
NULL,
N'Serienummer'
);


--HardwareVersion

INSERT INTO dbo.deviceModelAttribute
                           (  deviceModelId
                           ,   dataAttributeId
                           ,   attributeName
                           ,   attributeDescription
                           ,   attributeValueList
                           ,   includeInResponse
                           ,                          notificationType
                           ,                          triggerLogic
                           ,                          triggerValue
                           ,   attributeFriendlyName
                           )

VALUES
(
@deviceModelId,
14,
N'HardwareVersion',
N'Hårdvaruversion',
N'[ { "value": "string", "description": "Text", "selectable": false } ]',
'1',
'M',
NULL,
NULL,
N'Hårdvaruversion'
);


--SoftwareVersion

INSERT INTO dbo.deviceModelAttribute
                           (  deviceModelId
                           ,   dataAttributeId
                           ,   attributeName
                           ,   attributeDescription
                           ,   attributeValueList
                           ,   includeInResponse
                           ,                          notificationType
                           ,                          triggerLogic
                           ,                          triggerValue
                           ,   attributeFriendlyName
                           )

VALUES
(
@deviceModelId,
14,
N'SoftwareVersion',
N'Mjukvaruversion',
N'[ { "value": "string", "description": "Text", "selectable": false } ]',
'1',
'M',
NULL,
NULL,
N'Mjukvaruversion'
);


--DeviceClass

INSERT INTO dbo.deviceModelAttribute
                           (  deviceModelId
                           ,   dataAttributeId
                           ,   attributeName
                           ,   attributeDescription
                           ,   attributeValueList
                           ,   includeInResponse
                           ,                          notificationType
                           ,                          triggerLogic
                           ,                          triggerValue
                           ,   attributeFriendlyName
                           )

VALUES
(
@deviceModelId,
14,
N'DeviceClass',
N'Device Class',
N'[ { "value": "string", "description": "Text", "selectable": false } ]',
'1',
'M',
NULL,
NULL,
N'Device Class'
);


--Battery

INSERT INTO dbo.deviceModelAttribute
                           (  deviceModelId
                           ,   dataAttributeId
                           ,   attributeName
                           ,   attributeDescription
                           ,   attributeValueList
                           ,   includeInResponse
                           ,                          notificationType
                           ,                          triggerLogic
                           ,                          triggerValue
                           ,   attributeFriendlyName
                           )

VALUES
(
@deviceModelId,
6,
N'Battery',
N'Batteristatus i %',
N'[ { "value": "number", "description": "Mätvärde", "selectable": false } ]',
'1',
'M',
NULL,
NULL,
N'Batterivärde'
);


--IlluminanceLux

INSERT INTO dbo.deviceModelAttribute
                           (  deviceModelId
                           ,   dataAttributeId
                           ,   attributeName
                           ,   attributeDescription
                           ,   attributeValueList
                           ,   includeInResponse
                           ,                          notificationType
                           ,                          triggerLogic
                           ,                          triggerValue
                           ,   attributeFriendlyName
                           )

VALUES
(
@deviceModelId,
7,
N'IlluminanceLux',
N'Ljus i Lux',
N'[ { "value": "number", "description": "Mätvärde", "selectable": false } ]',
'1',
'M',
NULL,
NULL,
N'Illuminance Lux'
);


--FCntUp

INSERT INTO dbo.deviceModelAttribute
                           (  deviceModelId
                           ,   dataAttributeId
                           ,   attributeName
                           ,   attributeDescription
                           ,   attributeValueList
                           ,   includeInResponse
                           ,                          notificationType
                           ,                          triggerLogic
                           ,                          triggerValue
                           ,   attributeFriendlyName
                           )

VALUES
(
@deviceModelId,
6,
N'FCntUp',
N'Sekvensnummer payload',
N'[ { "value": "number", "description": "Mätvärde", "selectable": false } ]',
'0',
'M',
NULL,
NULL,
N'Sekvensnummer payload'
);



INSERT INTO dbo.iotPlatformDeviceModel
                           (  iotPlatformId
                           ,   deviceModelId
                           )

VALUES
(
1,
@deviceModelId
);



SET @iotPlatformDeviceModelId = SCOPE_IDENTITY();



INSERT INTO dbo.iotDeviceModelTag
                           (  iotPlatformDeviceModelId
                           ,   tag
                           ,   [value]
                           )

VALUES
(
@iotPlatformDeviceModelId,
'DeviceModelID',
'{"OTAA": "msight_em500-lgt_RFGroup1_1.0.3a_A", "ABP": "msight_em500-lgt_RFGroup1_1.0.3a_A"}'
);


    /* ---- Link to IoT Platforms -------------------------------------------- */

    /* ---- Link to Thingpark (iotPlatformId = 1) ---------------------------- */
    
INSERT INTO dbo.iotPlatformDeviceModel
                           (  iotPlatformId
                           ,   deviceModelId
                           )
    
VALUES
    (
    1,
    @deviceModelId
    );


    
SET @iotPlatformDeviceModelId = SCOPE_IDENTITY();


    
INSERT INTO dbo.iotDeviceModelTag
                           (  iotPlatformDeviceModelId
                           ,   tag
                           ,   [value]
                           )
    
VALUES
    (
    @iotPlatformDeviceModelId,
    'DeviceModelID',
    '{"OTAA": "' + @tpModel + '", "ABP": "' + @tpModel + '"}'
    );