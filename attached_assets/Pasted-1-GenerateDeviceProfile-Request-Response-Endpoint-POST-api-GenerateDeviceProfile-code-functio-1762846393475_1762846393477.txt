1. GenerateDeviceProfile – Request & Response
Endpoint
POST /api/GenerateDeviceProfile?code=<function_key>
Content-Type: application/json

Request body (JSON)

Shape:

{
  "deviceDocumentation": "string, required",
  "extraHints": "string, optional"
}


Semantics:

deviceDocumentation (required)
The big chunk of sensor-specific Watteco doc you previously pasted into the console app:

“Applicative Layer” section

default configuration

frame examples

known issues, etc.

extraHints (optional)
Free-form notes you used to type in the second editor, e.g.:

"This device only uses inputs 1 and 2"

"We always send on FPort 125"

"We only care about Binary Input cluster"

Example request
{
  "deviceDocumentation": "Applicative layer...\nExample frame: 110A000F00551001...",
  "extraHints": "We only care about Binary Input; device always uses FPort 125."
}

Success response (200 OK)

Shape:

{
  "profile": "string",
  "deviceName": "string",
  "safeClassName": "string"
}


profile
The full DEVICE PROFILE in markdown, following your strict template:

# DEVICE METADATA with - Name: ... etc

# ENDPOINTS & CONNECTORS table

# SUPPORTED CLUSTERS table

# DEFAULT REPORTING

# FRAME RECIPES

# KNOWN ISSUES / NOTES

deviceName
Extracted from the profile by scanning for the line:

- Name: <whatever>


If not found → "Device".

safeClassName
deviceName normalized into a safe identifier:

keep only letters and digits

prepend D if it would start with a digit

fall back to "Device" if everything is stripped.

Example success response
{
  "profile": "# DEVICE METADATA\n- Name: Pulse Sens'O AtEx Zone 1\n- FamilyCode: ...\n...",
  "deviceName": "Pulse Sens'O AtEx Zone 1",
  "safeClassName": "PulseSensOAtExZone1"
}

Error responses

Empty body:

{
  "error": "Request body is empty."
}


Bad JSON:

{
  "error": "Invalid JSON: <full exception message>"
}


Missing required field:

{
  "error": "Field 'deviceDocumentation' is required."
}


Model/completion failure:

{
  "error": "OpenAI call failed: <exception message>"
}


Model returned nothing:

{
  "error": "Model returned an empty profile."
}


All non-validation failures use HTTP 500.

2. GenerateDecoderCode – Request & Response
Endpoint
POST /api/GenerateDecoderCode?code=<function_key>
Content-Type: application/json

Request body (JSON)

Shape:

{
  "deviceProfile": "string, required",
  "deviceNameOverride": "string, optional",
  "safeClassNameOverride": "string, optional"
}


Semantics:

deviceProfile (required)
This is the full profile string returned from GenerateDeviceProfile (possibly edited by the user). The function passes this into the DecoderTemplate and asks the model to generate a C# file.

deviceNameOverride (optional)
If set and non-blank, this is used instead of inferring the name from the profile. Else it falls back to:

WattecoShared.ExtractDeviceNameFromProfile(deviceProfile)


safeClassNameOverride (optional)
If set and non-blank, this is used instead of MakeSafeIdentifier(deviceName).
If not provided, it is derived from the effective deviceName above.

So your UI can:

Take the deviceName and safeClassName from step 1,

Let the user tweak them,

Then send those as overrides here.

Example request using step-1 output
{
  "deviceProfile": "# DEVICE METADATA\n- Name: Pulse Sens'O AtEx Zone 1\n...",
  "deviceNameOverride": "Pulse SensO Atex Zone 1",
  "safeClassNameOverride": "PulseSensOAtexZone1"
}


Or minimum viable:

{
  "deviceProfile": "# DEVICE METADATA\n- Name: Pulse Sens'O AtEx Zone 1\n..."
}

Success response (200 OK)

Shape:

{
  "decoderCode": "string",
  "deviceName": "string",
  "safeClassName": "string"
}


decoderCode
A single C# source file as plain text, with:

namespace WattecoDecoders

public class Decoder<SafeClassName>

[Function("Decoder<SafeClassName>")]

Run([HttpTrigger("get", "post")] HttpRequest req)

All the hex decoding logic described in DecoderTemplate.

The function also strips any ``` code fences the model might emit.

deviceName
The effective device name the function decided to use:

override if provided, else extracted from the profile.

safeClassName
The effective safe class name:

override if provided, else generated from deviceName.

Example success response
{
  "decoderCode": "using System;\nusing System.Collections.Generic;\nusing System.Text.Json;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.Azure.Functions.Worker;\n\nnamespace WattecoDecoders\n{\n    public class DecoderPulseSensOAtexZone1\n    {\n        [Function(\"DecoderPulseSensOAtexZone1\")]\n        public async Task<IActionResult> Run([HttpTrigger(\"get\", \"post\")] HttpRequest req)\n        {\n            // ... full decoder code ...\n        }\n    }\n}\n",
  "deviceName": "Pulse SensO Atex Zone 1",
  "safeClassName": "PulseSensOAtexZone1"
}

Error responses

Empty body:

{
  "error": "Request body is empty."
}


Bad JSON:

{
  "error": "Invalid JSON: <full exception message>"
}


Missing required field:

{
  "error": "Field 'deviceProfile' is required."
}


Model returned no code:

{
  "error": "Model returned an empty decoder code."
}


Model/completion failure:

{
  "error": "OpenAI call failed: <exception message>"
}


Again, non-validation errors are 500.